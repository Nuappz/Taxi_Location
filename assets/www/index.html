<!DOCTYPE html>
<html>
  <head>
  	 <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
      
    	<title>Device Properties Example</title>
    	<script language="JavaScript" type="text/javascript" src="lib/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script type="text/javascript" src="backgroundService-3.1.0.js"></script>
	<script type="text/javascript" src="myService-3.1.0.js"></script>
		
        <script type="text/javascript" >
        	var myService = cordova.require('cordova/plugin/myService');
        	
        	document.addEventListener('deviceready', function() {
				getStatus();
  			}, true);

 			function handleSuccess(data) {
 				updateView(data);
 			}
 			
 			function handleError(data) {
				alert("Error: " + data.ErrorMessage);
 				alert(JSON.stringify(data));
				updateView(data);
 			}

			/*
			 * Button Handlers
			 */ 			
 			function getStatus() {
 				myService.getStatus(	function(r){handleSuccess(r)},
 										function(e){handleError(e)});
 			}
 			
 			function startService() {
				myService.startService(	function(r){
													handleSuccess(r);
													navigator.geolocation.getCurrentPosition(onSuccess, onError, {enableHighAccuracy:true});},
										function(e){handleError(e)});
 			}

 			function stopService() {
	 			myService.stopService(	function(r){handleSuccess(r)},
 										function(e){handleError(e)});
			}

 			function enableTimer() {
				myService.enableTimer(	60000,
										function(r){handleSuccess(r)},
										function(e){handleError(e)});
 			}

 			function disableTimer() {
	 			myService.disableTimer(	function(r){handleSuccess(r)},
 										function(e){handleError(e)});
			}
			 			
 			function registerForBootStart() {
				myService.registerForBootStart(	function(r){handleSuccess(r)},
												function(e){handleError(e)});
 			}

 			function deregisterForBootStart() {
				myService.deregisterForBootStart(	function(r){handleSuccess(r)},
													function(e){handleError(e)});
 			}

 			function registerForUpdates() {
				myService.registerForUpdates(	function(r){handleSuccess(r)},
												function(e){handleError(e)});
 			}

 			function deregisterForUpdates() {
				myService.deregisterForUpdates(	function(r){handleSuccess(r)},
												function(e){handleError(e)});
 			}

 			function setConfig() {
				var helloToTxt = document.getElementById("helloToTxt");
 				var helloToString = helloToTxt.value;
 				var config = { 
 								"HelloTo" : helloToString 
 							}; 
				myService.setConfiguration(	config,
											function(r){handleSuccess(r)},
											function(e){handleError(e)});
 			}

			/*
			 * View logic
			 */
 			function updateView(data) {
				var serviceBtn = document.getElementById("toggleService");
				var serviceStatus = document.getElementById("serviceStatus");
				serviceBtn.disabled = false;
				if (data.ServiceRunning) {
					serviceStatus.innerHTML = "Running";
					serviceBtn.onclick = stopService;
					navigator.geolocation.getCurrentPosition(onSuccess, onError, {enableHighAccuracy:true});
					timerBtn.disabled = false;
					//
					/*onDeviceReady();
					if (data.TimerEnabled) {
						timerStatus.innerHTML = "Enabled";
						timerBtn.onclick = disableTimer;
					} else {
						timerStatus.innerHTML = "Disabled";
						timerBtn.onclick = enableTimer;
					} */
					

					updateBtn.disabled = false;
					updateBtn.onclick = setConfig;

					refreshBtn.disabled = false;
					refreshBtn.onclick = getStatus;

				} else { 
					serviceStatus.innerHTML = "Not running";
					serviceBtn.onclick = startService;
					timerBtn.disabled = true;
					timerEnabled = false; 

					updateBtn.disabled = true;
					refreshBtn.disabled = true;
				} 

				bootBtn.disabled = false;
				if (data.RegisteredForBootStart) {
					bootStatus.innerHTML = "Registered";
					bootBtn.onclick = deregisterForBootStart;
				} else {
					bootStatus.innerHTML = "Not registered";
					bootBtn.onclick = registerForBootStart;
				}
				
				listenBtn.disabled = false;
				if (data.RegisteredForUpdates) {
					listenStatus.innerHTML = "Registered";
					listenBtn.onclick = deregisterForUpdates;
				} else {
					listenStatus.innerHTML = "Not registered";
					listenBtn.onclick = registerForUpdates;
				}

				if (data.Configuration != null)
				{
					try {
						var helloToTxt = document.getElementById("helloToTxt");
						helloToTxt.value = data.Configuration.HelloTo;
					} catch (err) {
					}
				}
				
				if (data.LatestResult != null)
				{
					try {
						var resultMessage = document.getElementById("resultMessage");
						resultMessage.innerHTML = data.LatestResult.Message;
 					} catch (err) {
 					}
				}
 			}

		</script>
    <script type="text/javascript" charset="utf-8">

    // onSuccess Geolocation
    //
    function onSuccess(position) {
        var element = document.getElementById('geolocation');
        element.innerHTML = 'Latitude: '           + position.coords.latitude              + '<br />' +
                            'Longitude: '          + position.coords.longitude             + '<br />' +
                            'Altitude: '           + position.coords.altitude              + '<br />' +
                            'Accuracy: '           + position.coords.accuracy              + '<br />' +
                            'Altitude Accuracy: '  + position.coords.altitudeAccuracy      + '<br />' +
                            'Heading: '            + position.coords.heading               + '<br />' +
                            'Speed: '              + position.coords.speed                 + '<br />' +
                            'Timestamp: '          + position.timestamp                    + '<br />';
            var param = {};
            param["taxi_id"] = "taxi_1";
		    param["latitude"] = position.coords.latitude;
		    param["longitude"] =position.coords.longitude;
		    param["phone_number"] = 9940700655;
		    param["status"] = 1;
		    //var data1 = [param];
		    	     
		   	dataSend(param);
    }

    // onError Callback receives a PositionError object
    //
    function onError(error) {
        alert('code: '    + error.code    + '\n' +
              'message: ' + error.message + '\n');
    }
    
    function dataSend(data1){
    	 alert(data1);	
    	 $.ajax({
   		        type : 'POST',
		        dataType : 'json',
		        url : "http://reignsoft.in/taxi/lib/api/tracker.inc.php",
		        data : data1,
		        cache : false,
		        success : function(data1) {
		           	alert("success");
		        },
		        error : function(data1){
		        	alert("Fails");
		        }
		    });
    }
    </script>
  </head>
  <body>
  	<h1>MyService V3.1.0</h1>
		
		<table>
			<tr>
				<th>Service</th>
				<td><div id="serviceStatus"></div></td>
				<td><input disabled id="toggleService" type="button" value="toggle"/></td>
			</tr>
		</table>
    <p id="geolocation">Finding geolocation...</p>
  </body>
</html>